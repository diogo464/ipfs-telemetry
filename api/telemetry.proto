syntax = "proto3";
package telemetry;

import "snapshot.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "git.d464.sh/adc/telemetry/pkg/proto/telemetry";

message SystemInfo {
    string os       = 1; 
    string arch     = 2;
    uint32 numcpu   = 3;
}

service Telemetry {
    rpc GetSessionInfo(google.protobuf.Empty) returns (GetSessionInfoResponse);
    rpc GetSystemInfo(google.protobuf.Empty) returns (SystemInfo);
    rpc GetSnapshots(GetSnapshotsRequest) returns (stream GetSnapshotsResponse);
    rpc GetEvents(GetEventsRequest) returns (stream GetEventsResponse);
}

message GetSessionInfoResponse  {
    string session                      = 1;
    google.protobuf.Timestamp boot_time = 2;
}

message GetSnapshotsRequest {
    uint64 since    = 1;
}

message GetSnapshotsResponse {
    uint64 next                             = 1;
    repeated snapshot.Snapshot snapshots    = 2;
}

message GetEventsRequest {
    uint64 since    = 1;
}

message GetEventsResponse {
    uint64 next                             = 1;
    repeated snapshot.Snapshot events       = 2;
}
