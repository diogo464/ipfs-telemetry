:source-highlighter: pygments
= Telemetry
:toc:
:toc-title: Contents

== Telemetry schema

=== Common
[cols="1,1,3"]
|===
| **Tag**
| peer
| PeerID in base58

| **Tag**
| session
| UUID of the session
|===

=== Session Info

[cols="1,1,3"]
|===
| **Measurement**
| session_info
|

| **Field**
| boot_time
| time the daemon was started at

|===

=== System Info

[cols="1,1,3"]
|===
| **Measurement**
| system_info
|

| **Field**
| os
| 

| **Field**
| arch
| 

| **Field**
| numcpu
| 
|===

=== Bandwidth

[cols="1,1,3"]
|===
| **Measurement**
| bandwidth
|

| **Field**
| upload
| Upload rate in byte/s

| **Field**
| download
| Download rate in byte/s
|===

=== Ping

[cols="1,1,3"]
|===
| **Measurement**
| ping
|

| **Field**
| data
| byte array with json structure containing information about the ping
|===

[source, go]
----
type Ping struct {
	Timestamp   time.Time       `json:"timestamp"`
	Source      peer.AddrInfo   `json:"source"`
	Destination peer.AddrInfo   `json:"destination"`
	Durations   []time.Duration `json:"durations"`
}
----

=== Connections

[cols="1,1,3"]
|===
| **Measurement**
| connections
|

| **Field**
| data
| byte array with json array of `Connection`

| **Field**
| count
| number of connections
|===

[source, go]
----
type Connection struct {
	ID      peer.ID             `json:"id"`
	Addr    multiaddr.Multiaddr `json:"addr"`
	Latency time.Duration       `json:"latency"`
}
----

=== Routing Table

[cols="1,1,3"]
|===
| **Measurement**
| routing_table
|

| **Field**
| data
| byte array with json 2d array of peer id, `[][]peer.ID`

| **Field**
| buckets
| number of buckets in the routing table

| **Field**
| peers
| number of peers in the routing table
|===

=== Network Conns

[cols="1,1,3"]
|===
| **Measurement**
| network_conns
|

| **Field**
| conns
| number of connections

| **Field**
| low_water
| low water

| **Field**
| high_water
| high water
|===

=== Network Stats

[cols="1,1,3"]
|===
| **Measurement**
| network_stats
|

| **Tag**
| protocol
| protocol id this stats are about

| **Field**
| total_in
| total number of in bytes

| **Field**
| total_out
| total number of out bytes

| **Field**
| rate_in
| rate of in bytes in byte/s

| **Field**
| rate_out
| rate of out bytes in byte/s
|===

=== Resources

[cols="1,1,3"]
|===
| **Measurement**
| resources
|

| **Field**
| cpu_process
| percentage cpu usage by the ipfs process

| **Field**
| cpu_system
| overall cpu usage by the system

| **Field**
| memory_used
| memory used by ipfs, in bytes

| **Field**
| memory_free
| memory free in the system, in bytes

| **Field**
| memory_total
| total available memory in the system

| **Field**
| goroutines
| number of existing goroutines
|===

=== Trace Route

[cols="1,1,3"]
|===
| **Measurement**
| traceroute
|

| **Field**
| output
| byte array with json structure
|===

[source, go]
----
type TraceRoute struct {
	Timestamp   time.Time
	Origin      peer.AddrInfo `json:"origin"`
	Destination peer.AddrInfo `json:"destination"`
	Provider    string        `json:"provider"`
	Output      []byte        `json:"output"`
}
----

=== Kademlia

[cols="1,1,3"]
|===
| **Measurement**
| kademlia
|

| **Tag**
| direction
| `in` or `out`

| **Tag**
| type
| message type

| **Field**
| count
| number of messages
|===

Message types::
    * putvalue
    * getvalue
    * addprovider
    * getproviders
    * findnode
    * ping

=== Kademlia Query

[cols="1,1,3"]
|===
| **Measurement**
| kademlia_query
|

| **Tag**
| remote_peer
| peerid this query is being made to

| **Tag**
| type
| message type

| **Field**
| duration
| number of nanoseconds until the response arrived
|===

=== Kademlia Handler

[cols="1,1,3"]
|===
| **Measurement**
| kademlia_handler
|

| **Tag**
| type
| message type

| **Field**
| handler
| number of nanoseconds to execute the handler function


| **Field**
| write
| number of nanoseconds to write the response to the stream

| **Field**
| total
| combined handler plus write time
|===

=== Bitswap

[cols="1,1,3"]
|===
| **Measurement**
| bitswap
|

| **Field**
| messages_in
| total number of bitswap messages received

| **Field**
| messages_out
| total number of bitswap messages sent


| **Field**
| discovery_succeeded
| number of sessions where discovery succeeded

| **Field**
| discovery_failed
| number of sessions where discovery failed
|===

=== Storage

[cols="1,1,3"]
|===
| **Measurement**
| storage
|

| **Field**
| storage_used
| number of storage bytes in use

| **Field**
| storage_total
| number of storage bytes available


| **Field**
| num_objects
| number of objects in storage
|===
